var shares=null;function plusReady(){updateSerivces()}if(window.plus){plusReady()}else{document.addEventListener('plusready',plusReady,false)}function updateSerivces(){plus.share.getServices(function(s){shares={};for(var i in s){var t=s[i];shares[t.id]=t}},function(e){alert('获取分享服务列表失败：'+e.message)})}function shareSystemNativeJS(){if(plus.os.name!=='Android'){plus.nativeUI.alert('此平台暂不支持系统分享功能!');return}var intent=new Intent(Intent.ACTION_SEND);if(pic&&pic.realUrl){var p='';p=pic.realUrl;if(p.substr(0,7)==='file://'){p=p.substr(7)}else if(p.sub(0)!=='/'){p=plus.io.convertLocalFileSystemURL(p)}}var f=new File(p);var uri=Uri.fromFile(f);if(f.exists()&&f.isFile()){console.log('image/*');intent.setType('image/*');intent.putExtra(Intent.EXTRA_STREAM,uri)}else{console.log('text/plain');intent.setType('text/plain')}intent.putExtra(Intent.EXTRA_SUBJECT,'HelloH5');intent.putExtra(Intent.EXTRA_TEXT,sharecontent.value);intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);main.startActivity(Intent.createChooser(intent,'系统分享HelloH5'))}function shareAction(sb,bh){if(!sb||!sb.s){alert('无效的分享服务！');return}var msg={content:sharecontent.value,extra:{scene:sb.x}};if(bh){msg.href=sharehref.value;if(sharehrefTitle&&sharehrefTitle.value!=''){msg.title=sharehrefTitle.value}if(sharehrefDes&&sharehrefDes.value!=''){msg.content=sharehrefDes.value}msg.thumbs=['_www/logo.png'];msg.pictures=['_www/logo.png']}else{if(pic&&pic.realUrl){msg.pictures=[pic.realUrl]}}if(sb.s.authenticated){shareMessage(msg,sb.s)}else{sb.s.authorize(function(){shareMessage(msg,sb.s)},function(e){alert('认证授权失败：'+e.code+' - '+e.message)})}}function shareMessage(msg,s){s.send(msg,function(){alert('分享到"'+s.description+'"成功！')},function(e){alert('分享到"'+s.description+'"失败: '+JSON.stringify(e))})}function cancelAuth(){try{for(var i in shares){var s=shares[i];if(s.authenticated){alert('取消"'+s.description+'"')}s.forbid()}updateSerivces();alert('操作成功！')}catch(e){alert(e)}}function shareCameraPicture(){var cmr=plus.camera.getCamera();cmr.captureImage(function(p){plus.io.resolveLocalFileSystemURL(p,function(entry){pic.src=entry.toLocalURL();pic.realUrl=p},function(e){alert('读取拍照文件错误：'+e.message)})},function(e){alert('拍照失败：'+e.message)})}function shareGalleryPicture(){plus.gallery.pick(function(p){pic.src=p;pic.realUrl=pic.src;alert('选择图片：'+pic.realUrl);})}function shareLogoPicture(){alert('使用Logo分享图片：');var url='_www/logo.png';plus.io.resolveLocalFileSystemURL(url,function(entry){pic.src=entry.toLocalURL();pic.realUrl=url},function(e){alert('读取Logo文件错误：'+e.message)})}function shareHref(){var shareBts=[];var ss=shares['weixin'];ss&&ss.nativeClient&&(shareBts.push({title:'微信朋友圈',s:ss,x:'WXSceneTimeline'}),shareBts.push({title:'微信好友',s:ss,x:'WXSceneSession'}));ss=shares['qq'];ss&&ss.nativeClient&&shareBts.push({title:'QQ',s:ss});shareBts.length>0?plus.nativeUI.actionSheet({title:'分享链接',cancel:'取消',buttons:shareBts},function(e){(e.index>0)&&shareAction(shareBts[e.index-1],true)}):plus.nativeUI.alert('当前环境无法支持分享链接操作!')}